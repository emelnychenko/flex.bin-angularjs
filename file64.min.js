!function(){"use strict";angular.module("flex.bin",[]).directive("fxFile64",["$q","$timeout",function(a,b){return{restrict:"A",require:"ngModel",scope:{fxStart:"="},link:function(c,d,e,f){var g=new Array,h=new Array,i=function(a,b){var d=new FileReader;d.onabort=function(a){f.$setValidity("abort",!1),e.fxOnabort&&c.$parent.$eval(e.fxOnabort)},d.onloadstart=function(a){e.fxOnloadstart&&c.$parent.$eval(e.fxOnloadstart)},d.onload=function(a){e.fxOnload&&c.$parent.$eval(e.fxOnload)},d.onloadend=function(a){e.fxOnloadend&&c.$parent.$eval(e.fxOnloadend),b(d)},e.fxOnprogress&&(d.onprogress=c.$parent.$eval(e.fxOnprogress)),d.onerror=function(a){f.$setValidity("load",!1),e.fxOnerror&&(d.onerror=c.$parent.$eval(e.fxOnerror))},d.readAsDataURL(a)},j=function(b){var c=new Array;angular.forEach(g,function(b){var d=e.fxType?new RegExp(e.fxType.replace(/\*/i,".*?")):void 0;if(e.fxMinitem&&g.length<e.fxMinitem)f.$setValidity("minitem",!1);else if(e.fxMaxitem&&g.length>e.fxMaxitem)f.$setValidity("maxitem",!1);else if(e.fxMinsize&&b.size<e.fxMinsize)f.$setValidity("minsize",!1);else if(e.fxMaxsize&&b.size>e.fxMaxsize)f.$setValidity("maxsize",!1);else if(d&&!d.test(b.type))f.$setValidity("accept",!1);else{var h=a.defer();i(b,function(a){h.resolve({reader:a,file:b})}),c.push(h.promise)}}),a.all(c).then(function(a){h=new Array,angular.forEach(a,function(a){null===a.reader.error&&h.push({name:a.file.name,size:a.file.size,type:a.file.type,base:a.reader.result})}),b(h)})},k=function(){if(g=d[0].files,f.$setValidity("minsize",null),f.$setValidity("maxsize",null),f.$setValidity("minitem",null),f.$setValidity("maxitem",null),f.$setValidity("accept",null),f.$setValidity("abort",null),f.$setValidity("load",null),e.fxStart){var h=c.$parent.$eval(e.fxStart);h&&(h(),c.$apply())}var i=a.defer();i.resolve(function(a){if(f.$setViewValue(e.multiple?a:a[0]),e.fxEnd){var b=c.$parent.$eval(e.fxEnd);b&&b()}}),b(function(){i.promise.then(j)},0)};d.bind("change",k)}}}])}();
